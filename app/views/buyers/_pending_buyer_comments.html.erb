<%= form_tag update_pending_buyer_comments_buyer_path do %>
<table class="table table-striped">
  <thead class="thead-dark">
    <tr>
      <th scope="col" style="width: 5%">Select</th>
      <th scope="col" style="width: 10%">Airway Bill No</th>
      <th scope="col" style="width: 10%">Delivered On</th>
      <th scope="col" style="width: 15%">Description</th>
      <th scope="col" style="width: 15%">Sample Type</th>
      <th scope="col" style="width: 5%">No of items</th>
      <th scope="col" style="width: 10%">Photo</th>
      <th scope="col" style="width: 15%">Approval</th>
      <th scope="col" style="width: 20%">Vendor Comments</th>
    </tr>
  </thead>
  <tbody>
    <% if @items.present? %>
      <% @items.each do |item| %>
        <tr>
          <td><%= check_box_tag "items[id][#{item.id}]", '', false, class: 'checkbox'%></td>
          <td><%= item.courier.airway_bill_number %></td>
          <td><%= delivery_date_display(item.courier) %></td>
          <td><%= item.description%></td>
          <td><%= item.sample_type_name %></td>
          <td><%= item.number_of_samples %></td>
          <td><%= image_tag item.item_image.variant(resize: "100x100") if item.item_image.attached? %></td>
          <td><%= select_tag "items[buyer_approved][#{item.id}]", options_for_select(['Select', 'Approved', 'Pending'])%></td>
          <td><%= text_field_tag "items[buyer_comments][#{item.id}]", '', style: 'width: 100%'%></td>
        </tr>
      <% end %>
    <% else %>
      <tr>
        <td colspan="9" class="text-center">No items with pending comments</td>
      </tr>
    <% end %>
  </tbody>
</table>
<%= hidden_field_tag 'buyer_id', @buyer.id%>
<div id="submit_div" style="display: none;">
  <%= submit_tag 'Save', id: 'submit', class: 'btn btn-success'%>
</div>
<% end %>
<script type="text/javascript">
  $('.checkbox').click(function(){
    if ($("input:checkbox:checked").length > 0)
    {
      $('#submit_div').show();
    }
    else
    {
      $('#submit_div').hide();
    }
  })

  $('#submit').on('click', function (e) {
    $("input:checked").each(function () {
        var id = $(this).attr("id").split('_')[2];
        if($('#items_buyer_approved_'+id).val() == 'Select'){
          alert('Select the approval status for all checked items');
          e.preventDefault();
          return false;
        }
    });
  })
</script>